function at(t){return Array.from(new Set(t))}const ct="0.4.204",A={projectName:"Vike",projectVersion:ct},_=`_${A.projectName.toLowerCase()}`;function R(t,e){const n=lt();return n[t]=n[t]||e}function lt(){return globalThis[_]=globalThis[_]||{}}const c=new Proxy({},{get:(t,e)=>n=>e==="code"?`\`${n}\``:e==="string"?`'${n}'`:n}),g=R("assertSingleInstance.ts",{instances:[],alreadyLogged:new Set}),ut="Client runtime of both Server Routing and Client Routing loaded https://vike.dev/client-runtimes-conflict",J="Client runtime loaded twice https://vike.dev/client-runtime-duplicated";function G(){{const t=at(g.instances);ht(t.length<=1,`vike@${c.bold(t[0])} and vike@${c.bold(t[1])} loaded but only one version should be loaded`)}g.checkSingleInstance&&g.instances.length>1&&P(!1,J,{onlyOnce:!0,showStackTrace:!0})}function Dt(t){P(g.isClientRouting!==!1,ut,{onlyOnce:!0,showStackTrace:!0}),P(g.isClientRouting===void 0,J,{onlyOnce:!0,showStackTrace:!0}),g.isClientRouting=!0,g.checkSingleInstance=!0,G()}function ft(){g.instances.push(A.projectVersion),G()}function ht(t,e){if(t)return;const n=`[vike][Wrong Usage] ${e}`;throw new Error(n)}function P(t,e,{onlyOnce:n,showStackTrace:r}){if(t)return;const o=`[vike][Warning] ${e}`;if(n){const{alreadyLogged:i}=g,a=n===!0?o:n;if(i.has(a))return;i.add(a)}console.warn(r?new Error(o):o)}function dt(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function S(t,e){const n=new Error(t);return dt()&&(n.stack=pt(n.stack,e)),n}function pt(t,e){if(!t)return t;const n=bt(t);let r=0;return n.filter(i=>i.includes(" (internal/")||i.includes(" (node:internal")?!1:r<e&&gt(i)?(r++,!1):!0).join(`
`)}function gt(t){return t.startsWith("    at ")}function bt(t){return t.split(/\r?\n/)}function j(t){return typeof t=="object"&&t!==null}const l=R("utils/assert.ts",{alreadyLogged:new Set,logger(t,e){e==="info"?console.log(t):console.warn(t)},showStackTraceList:new WeakSet});ft();const mt="[vike]",wt=`[vike@${A.projectVersion}]`,v=2;function s(t,e){if(t)return;const n=(()=>{if(!e)return null;const a=typeof e=="string"?e:JSON.stringify(e);return c.dim(`Debug info (for Vike maintainers; you can ignore this): ${a}`)})();let o=[`You stumbled upon a Vike bug. Go to ${c.blue("https://github.com/vikejs/vike/issues/new")} and copy-paste this error. A maintainer will fix the bug (usually under 24 hours).`,n].filter(Boolean).join(" ");o=w(o),o=T(o,"Bug"),o=k(o,!0);const i=S(o,v);throw l.onBeforeLog?.(),i}function O(t,e,{showStackTrace:n}={}){if(t)return;n=n||l.alwaysShowStackTrace,e=w(e),e=T(e,"Wrong Usage"),e=k(e);const r=S(e,v);throw n&&l.showStackTraceList.add(r),l.onBeforeLog?.(),r}function kt(t){return t=w(t),t=T(t,"Error"),t=k(t),S(t,v)}function C(t,e,{onlyOnce:n,showStackTrace:r}){if(!t){if(r=r||l.alwaysShowStackTrace,e=w(e),e=T(e,"Warning"),e=k(e),n){const{alreadyLogged:o}=l,i=n===!0?e:n;if(o.has(i))return;o.add(i)}if(l.onBeforeLog?.(),r){const o=S(e,v);l.showStackTraceList.add(o),l.logger(o,"warn")}else l.logger(e,"warn")}}function Jt(t,e,{onlyOnce:n}){if(e=w(e),e=k(e),n){const{alreadyLogged:r}=l,o=e;if(r.has(o))return;r.add(o)}l.onBeforeLog?.(),l.logger(e,"info")}function T(t,e){let n=`[${e}]`;const r=e==="Warning"?"yellow":"red";return n=c.bold(c[r](n)),`${n}${t}`}function w(t){return t.startsWith("[")?t:` ${t}`}function k(t,e=!1){return`${e?wt:mt}${t}`}function B(t){const e=t/1e3;if(e<120){const n=N(e);return`${n} second${V(n)}`}{const n=e/60,r=N(n);return`${r} minute${V(r)}`}}function N(t){let e=t.toFixed(1);return e.endsWith(".0")&&(e=e.slice(0,-2)),e}function V(t){return t==="1"?"":"s"}const U=R("utils/executeHook.ts",{userHookErrors:new WeakMap,pageContext:null});function Gt(t,e,n){const{hookName:r,hookFilePath:o,hookTimeout:{error:i,warning:a}}=e;let h,f;const $=new Promise((u,W)=>{h=p=>{b(),u(p)},f=p=>{b(),W(p)}}),b=()=>{m&&clearTimeout(m),d&&clearTimeout(d)},m=H(a)&&setTimeout(()=>{C(!1,`The ${r}() hook defined by ${o} is slow: it's taking more than ${B(a)} (https://vike.dev/hooksTimeout)`,{onlyOnce:!1})},a),d=H(i)&&setTimeout(()=>{const u=kt(`The ${r}() hook defined by ${o} timed out: it didn't finish after ${B(i)} (https://vike.dev/hooksTimeout)`);f(u)},i);return(async()=>{try{$t(n);const u=await t();h(u)}catch(u){j(u)&&U.userHookErrors.set(u,{hookName:r,hookFilePath:o}),f(u)}})(),$}function H(t){return!!t&&t!==1/0}function $t(t){U.pageContext=t,Promise.resolve().then(()=>{U.pageContext=null})}function Y(){return typeof window<"u"&&typeof window.scrollY=="number"}const q=R("utils/assertRouterType.ts",{});function Wt(){jt(yt()),q.isClientRouting=!0}function yt(){return q.isClientRouting!==!1}function jt(t){O(Y(),`${c.cyan("import { something } from 'vike/client/router'")} is forbidden on the server-side`,{showStackTrace:!0}),C(t,"You shouldn't `import { something } from 'vike/client/router'` when using Server Routing. The 'vike/client/router' utilities work only with Client Routing. In particular, don't `import { navigate }` nor `import { prefetch }` as they unnecessarily bloat your client-side bundle sizes.",{showStackTrace:!0,onlyOnce:!0})}function Rt(t){return t instanceof Function||typeof t=="function"}function E(t){return Array.isArray(t)}function St(t){return E(t)&&t.every(e=>typeof e=="string")}function vt(t){return j(t)&&Object.values(t).every(e=>typeof e=="string")}function Ot(t,e,n){if(!j(t))return!1;if(!(e in t))return n==="undefined";if(n===void 0)return!0;const r=t[e];return n==="undefined"?r===void 0:n==="array"?E(r):n==="object"?j(r):n==="string[]"?St(r):n==="string{}"?vt(r):n==="function"?Rt(r):E(n)?typeof r=="string"&&n.includes(r):n==="null"?r===null:n==="true"?r===!0:n==="false"?r===!1:typeof r===n}function K(t,e){e&&(s(!("_isPageContextObject"in e)),Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)))}function F(t,e,n){return typeof t=="string"?z(t.split(""),e,n).join(""):z(t,e,n)}function z(t,e,n){const r=[];let o=e>=0?e:t.length+e;s(o>=0&&o<=t.length);let i=n>=0?n:t.length+n;for(s(i>=0&&i<=t.length);!(o===i||(o===t.length&&(o=0),o===i));){const a=t[o];s(a!==void 0),r.push(a),o++}return r}function Yt(t,e){s(Lt(t),t),s(e.startsWith("/"));const[n,...r]=t.split("#");s(n!==void 0);const o=["",...r].join("#")||null;s(o===null||o.startsWith("#"));const i=o===null?"":Q(o.slice(1)),[a,...h]=n.split("?");s(a!==void 0);const f=["",...h].join("?")||null;s(f===null||f.startsWith("?"));const $={},b={};Array.from(new URLSearchParams(f||"")).forEach(([y,I])=>{$[y]=I,b[y]=[...b.hasOwnProperty(y)?b[y]:[],I]});let{protocol:m,origin:d,pathnameAbsoluteWithBase:u}=Pt(a,e);const W=a.slice((d||"").length);xt(t,d,W,f,o);let{pathname:p,hasBaseServer:nt}=At(u,e);const rt=Z(d,p,f,o),ot=d?d.slice(m.length):null,{hostname:it,port:st}=Ut(ot,t);return p=Tt(p),s(p.startsWith("/")),{href:rt,protocol:m,hostname:it,port:st,origin:d,pathname:p,pathnameOriginal:W,hasBaseServer:nt,search:$,searchAll:b,searchOriginal:f,hash:i,hashOriginal:o}}function Q(t){try{return decodeURIComponent(t)}catch{}try{return decodeURI(t)}catch{}return t}function Tt(t){return t=t.replace(/\s+$/,""),t=t.split("/").map(e=>Q(e).split("/").join("%2F")).join("/"),t}function Pt(t,e){s(!t.includes("?")&&!t.includes("#"));{const{protocol:n,origin:r,pathname:o}=D(t);if(r)return{protocol:n,origin:r,pathnameAbsoluteWithBase:o};s(o===t)}if(t.startsWith("/"))return{protocol:null,origin:null,pathnameAbsoluteWithBase:t};{const n=typeof window<"u"?window?.document?.baseURI:void 0;let r;return n?r=D(n.split("?")[0].split("#")[0]).pathname:r=e,{protocol:null,origin:null,pathnameAbsoluteWithBase:Et(t,r)}}}function D(t){if(L(t)){const{protocol:e,uriWithoutProtocol:n}=x(t);s(e);const[r,...o]=n.split("/"),i=e+r;return{pathname:"/"+o.join("/"),origin:i,protocol:e}}else return{pathname:t,origin:null,protocol:null}}function Ut(t,e){const n={hostname:null,port:null};if(!t)return n;const r=t.split(":");if(r.length>1){const o=parseInt(r.pop(),10);s(o||o===0,e),n.port=o}return n.hostname=r.join(":"),n}function x(t){const e=":",[n,...r]=t.split(e);if(r.length===0||!/^[a-z][a-z0-9\+\-]*$/i.test(n))return{protocol:null,uriWithoutProtocol:t};let o=n+e,i=r.join(e);const a="//";return i.startsWith(a)&&(o=o+a,i=i.slice(a.length)),{protocol:o,uriWithoutProtocol:i}}function X(t){return["ipfs://","ipns://"].includes(t)?!1:t.endsWith("://")}function Et(t,e){const n=e.split("/"),r=t.split("/");let o=e.endsWith("/");t.startsWith(".")&&n.pop();for(const a in r){const h=r[a];h==""&&a==="0"||h!="."&&(h==".."?n.pop():(o=!1,n.push(h)))}let i=n.join("/");return o&&!i.endsWith("/")&&(i+="/"),i.startsWith("/")||(i="/"+i),i}function At(t,e){s(t.startsWith("/")),s(Ct(e));let n=t;if(s(n.startsWith("/")),s(e.startsWith("/")),e==="/")return{pathname:t,hasBaseServer:!0};let r=e;return e.endsWith("/")&&n===F(e,0,-1)&&(r=F(e,0,-1),s(n===r)),n.startsWith(r)?(s(n.startsWith("/")||n.startsWith("http")),s(n.startsWith(r)),n=n.slice(r.length),n.startsWith("/")||(n="/"+n),s(n.startsWith("/")),{pathname:n,hasBaseServer:!0}):{pathname:t,hasBaseServer:!1}}function Ct(t){return t.startsWith("/")}function xt(t,e,n,r,o){const i=Z(e,n,r,o);s(t===i)}function Z(t,e,n,r){return`${t||""}${e}${n||""}${r||""}`}function Lt(t){return L(t)||t.startsWith("/")||M(t)}function It(t){return t.startsWith("/")||_t(t)||L(t)}function M(t){return[".","?","#"].some(e=>t.startsWith(e))||t===""}function qt(t){return!t.startsWith("/")&&!M(t)}function L(t){const{protocol:e}=x(t);return!!e&&X(e)}function _t(t){const{protocol:e}=x(t);return!!e&&!X(t)}function Kt(t,e){tt(t,e)}function Bt(t,e,n){tt(t,e,{isRedirectTarget:!0})}function tt(t,e,{isRedirectTarget:n}={}){if(t.startsWith("/"))return;let r=`${e} is ${c.string(t)} but it should start with ${c.string("/")}`;if(n){if(It(t))return;if(r+=` or a protocol (${c.string("http://")}, ${c.string("mailto:")}, ...)`,n==="unresolved"){if(t==="*")return;r+=`, or be ${c.string("*")}`}}O(!1,r)}function Nt(t,e,n=r=>r){if(s(t.length>0),t.length===1)return n(t[0]);const r=t.slice(0,t.length-1),o=t[t.length-1];return r.map(n).join(", ")+`, ${e} `+n(o)}Y()&&Wt();function Qt(t,e){const n="throw redirect()";Bt(t,zt(n));const r=[JSON.stringify(t)];e?(Ht(e,[301,302],"redirect"),r.push(String(e))):e=302;const o={};return K(o,{_abortCaller:n,_abortCall:`redirect(${r.join(", ")})`,_urlRedirect:{url:t,statusCode:e}}),Vt(o)}function Vt(t){const e=new Error("AbortRender");return K(e,{_pageContextAbort:t,[et]:!0}),e}const et="_isAbortError";function Xt(t){return typeof t=="object"&&t!==null&&et in t}function Zt(t){return t._urlRewrite||t._urlRedirect||t.abortStatusCode?(s(Ot(t,"_abortCall","string")),!0):!1}function Ht(t,e,n){const r=Nt(e.map(o=>o.toString()),"or");C(e.includes(t),`Unepexected status code ${t} passed to ${n}(), we recommend ${r} instead. (Or reach out at https://github.com/vikejs/vike/issues/1008 if you believe ${t} should be added.)`,{onlyOnce:!0})}function Mt(t){Ft(t);const e={_urlRewrite:null};return t.forEach(n=>{Object.assign(e,n)}),e}function Ft(t){const e=[];t.forEach(n=>{const r=n._urlRewrite;{const o=e.indexOf(r);if(o!==-1){const i=[...e.slice(o),r].map(a=>`render('${a}')`).join(" => ");O(!1,`Infinite loop of render() calls: ${i}`)}}e.push(r)})}function te(t,e){const n=[t>0&&c.cyan("throw render('/some-url')"),e>0&&c.cyan("throw redirect('/some-url')")].filter(Boolean).join(" and ");O(t+e<=7,`Maximum chain length of 7 ${n} exceeded. Did you define an infinite loop of ${n}?`)}function zt(t){return`URL passed to ${c.code(t)}`}export{Vt as A,Mt as B,Xt as C,Dt as D,s as a,O as b,E as c,C as d,j as e,Y as f,R as g,Ot as h,Rt as i,Wt as j,Yt as k,Gt as l,Zt as m,kt as n,K as o,c as p,Ct as q,Qt as r,F as s,Lt as t,at as u,qt as v,Nt as w,Kt as x,Jt as y,te as z};
