<!DOCTYPE html>
    <html lang="zh-CN">
      <head>
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/onCreateApp.1UIJUIFG.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_components_AlgoliaSearchBox_index-c05b3df4.Dv67hCk6.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_layouts_default_aside-6ea01de8.BjbON5Ij.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_layouts_default_navbar-403af73f.u3IytZI2.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/vitepress_components_VPDocOutlineItem-0942cada.tkRPm3MX.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/vitepress_components_VPDocAsideOutline-8a36deb9.BQ3_XqdU.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/pages_uno-88a4f3d7.C9zII3Ct.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_common_reset-f7a68b0e.BAKp5MHC.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_common_color-a7a524c7.CVau4Kly.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_common_is-19c6c24d.DKAKruk7.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-077ff7a2.BV4wSeDz.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-5bc474ab.Beul3IQx.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_reset-752cc03d.htEpr2M-.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_form-item-877afd6a.Dy4HJB2K.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_table-6cbc5816.DXG1SsxY.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_tabs-67d1a98b.BMDMQPDv.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_tree-cc28503d.nmT5n0wM.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_dialog-7f91a00e.D4nTsJge.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_breadcrumb-8ce3a1a1.CwEEGJYc.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_element-plus_menu-33b44202.hFAFO4eV.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-89174e94.BR4hnCDy.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-4f6ba709.BBK-T9RK.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-00953a13.Cc2PI5FU.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_form_sub-7371c85e.y3zh-mS3.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_layout_index-2891f17b.BNCqvENj.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-950dc3c2._P5PZSZ2.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-bedda3f4.BZwgKm1s.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-48dc0e7f.CFNWXuiE.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-89228798.Di2LGzYR.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-9d491700.C8H6Fcyw.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_markdown_reset-fbd16bdd.D3vNaEcf.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_styles_markdown_shiki-0d2326df.uut6VZYd.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-9fd907fe.CGks1hNn.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-0c26771b.D_b_s_8M.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-7c8dd18c.CN6bhMMp.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/style-90d911cf.C1dHN9_5.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_layouts_default_index-a6f52725.DkwwbNdY.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_layouts_default_index-faa86ca4.DrA58BD7.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/src_layouts_default_index-ae92d183.CQLOEbHd.css">
        <link rel="stylesheet" type="text/css" href="/vunk-shared/assets/static/pages_uno-88a4f3d7.B3Cec7rV.css">
        <meta charset="UTF-8" />
        
    
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!--[--><!--[--><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3"><!--]--><!--]-->
    
    
    
  
      </head>
      <body>
        
        <div id="app"><div class="vk-duplex layout-default" style="--vk-duplex-overflow:hidden;--vk-duplex-flex:1;--vk-duplex-direction:column;--vk-duplex-gap:0;"><div class="vk-duplex-1 with-overflow"><!--[--><div class="layout-default-header"><div sk-flex="row-between-center" class="h-full layout-default-navbar"><div class="font-600 plr-l ptb-s text-primary"> @vunk/shared </div><div sk-flex="row_center" sub:gml-s><ul role="menubar" style="--el-menu-level:0;" class="el-menu el-menu--horizontal"><!--[--><!--[--><!--[--><li class="el-menu-item" role="menuitem" tabindex="-1"><!--[--><!--[--><!--[--><!--[--><!--[--><a href="/vunk-shared/zh-CN/guide/introduction" class="layout-default-nav-menu-a" title="指南"></a><!--]--><!--]--><!--]--><!--]--><!--[--><!--[--><!--[--><!--[--><span class="layout-default-nav-menu-title">指南</span><!--]--><!--]--><!--]--><!--]--><!--]--></li><!--]--><!--]--><!--[--><!--[--><li class="el-menu-item" role="menuitem" tabindex="-1"><!--[--><!--[--><!--[--><!--[--><!--[--><a href="/vunk-shared/zh-CN/component/array/bubbleSort" class="layout-default-nav-menu-a" title="组件"></a><!--]--><!--]--><!--]--><!--]--><!--[--><!--[--><!--[--><!--[--><span class="layout-default-nav-menu-title">组件</span><!--]--><!--]--><!--]--><!--]--><!--]--></li><!--]--><!--]--><!--]--></ul><div class="theme-toggler-content" data-v-47d0f47c><div aria-label="theme-toggler" aria-checked="false" data-v-47d0f47c data-v-eebe66d4><!----></div></div></div></div></div><!--]--></div><div class="vk-duplex-2 with-flex with-overflow"><!--[--><!--]--><!--[--><div sk-flex class="h-100% relative"><div class="layout-default-aside-x bg-bg-base"><div class="vk-duplex layout-default-aside" style="--vk-duplex-overflow:hidden;--vk-duplex-flex:1;--vk-duplex-direction:column;--vk-duplex-gap:var(--gap-m);"><div class="vk-duplex-1 with-overflow"><!--[--><div class="page-agent-main-top-options" sk-flex="row-between-center" mlr-m mt-m><!--[--><i class="el-icon cursor-pointer el-tooltip__trigger el-tooltip__trigger" style="font-size:24px;"><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M896 192H128v128h768zm0 256H384v128h512zm0 256H128v128h768zM320 384 128 512l192 128z"></path></svg><!--]--></i><!--[--><!--v-if--><!--]--><!--]--><!--[--><i class="el-icon cursor-pointer el-tooltip__trigger el-tooltip__trigger" style="font-size:22px;"><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704"></path></svg><!--]--></i><!--[--><!--v-if--><!--]--><!--]--></div><!--]--></div><div class="vk-duplex-2 with-flex with-overflow"><!--[--><!--]--><!--[--><div class="vk-duplex h-full" style="--vk-duplex-overflow:hidden;--vk-duplex-flex:1;--vk-duplex-direction:column;--vk-duplex-gap:0;"><div class="vk-duplex-1 with-overflow"><!--[--><div id="docsearch" style="display:none;"></div><!--]--></div><div class="vk-duplex-2 with-flex with-overflow"><!--[--><div class="el-scrollbar"><div class="el-scrollbar__wrap el-scrollbar__wrap--hidden-default" style=""><div class="el-scrollbar__view" style=""><!--[--><ul role="menubar" style="--el-menu-level:0;" class="el-menu el-menu--vertical layout-default-aside-menu"><!--[--><!--]--></ul><!--]--></div></div><!--[--><div class="el-scrollbar__bar is-horizontal" style="display:none;"><div class="el-scrollbar__thumb" style="width:;transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical" style="display:none;"><div class="el-scrollbar__thumb" style="height:;transform:translateY(0%);"></div></div><!--]--></div><!--]--><!--[--><!--]--></div></div><!--]--></div></div></div><div class="vk-duplex flex-1 overflow-hidden" style="--vk-duplex-overflow:hidden;--vk-duplex-flex:1;--vk-duplex-direction:column;--vk-duplex-gap:0;"><div class="vk-duplex-1 with-overflow"><!--[--><!--]--></div><div class="vk-duplex-2 with-flex with-overflow"><!--[--><!--]--><!--[--><div class="el-scrollbar"><div class="el-scrollbar__wrap el-scrollbar__wrap--hidden-default" style=""><div id="VPScrollView" class="el-scrollbar__view" style=""><!--[--><main class="page-content"><div position-absolute pt-m pl-m style="display:none;"><i class="el-icon cursor-pointer" style="font-size:24px;"><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M128 192h768v128H128zm0 256h512v128H128zm0 256h768v128H128zm576-352 192 160-192 128z"></path></svg><!--]--></i></div><div class="doc-content-wrapper"><div id="VPContent" class="doc-content-container"><!--[--><div class="vp-doc VPDoc doc-content"><h1 id="restfetch" tabindex="-1">RestFetch <a class="header-anchor" href="#restfetch" aria-label="Permalink to &quot;RestFetch&quot;">​</a></h1><p>RestFetch 是一个功能强大的 HTTP 客户端封装，基于浏览器原生的 fetch API 实现。它提供了请求拦截、响应拦截、请求队列、缓存、超时处理等丰富功能。</p><h2 id="基础用法" tabindex="-1">基础用法 <a class="header-anchor" href="#基础用法" aria-label="Permalink to &quot;基础用法&quot;">​</a></h2><h3 id="创建实例" tabindex="-1">创建实例 <a class="header-anchor" href="#创建实例" aria-label="Permalink to &quot;创建实例&quot;">​</a></h3><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { RestFetch } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;@vunk/shared/fetch&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> client</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  baseURL: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;https://api.example.com&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  timeout: </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">5000</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 5 秒超时</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h3 id="发送请求" tabindex="-1">发送请求 <a class="header-anchor" href="#发送请求" aria-label="Permalink to &quot;发送请求&quot;">​</a></h3><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// GET 请求</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/users&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  params: { page: </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// POST 请求</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;POST&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/users&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  data: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    name: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;John&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    email: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;john@example.com&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h2 id="高级特性" tabindex="-1">高级特性 <a class="header-anchor" href="#高级特性" aria-label="Permalink to &quot;高级特性&quot;">​</a></h2><h3 id="中间件" tabindex="-1">中间件 <a class="header-anchor" href="#中间件" aria-label="Permalink to &quot;中间件&quot;">​</a></h3><p>中间件提供了一种强大的方式来处理请求和响应。每个中间件可以访问请求上下文、响应数据，并决定是否调用下一个中间件。</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 添加时间戳中间件</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">addMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">async</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">ctx</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">next</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  // 修改请求参数</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  ctx.req.requestOptions.params </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    ...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">ctx.req.requestOptions.params,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    startTime: Date.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">now</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(),</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  // 调用下一个中间件</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  await</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> next</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  // 处理响应数据</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> data</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> ctx.res.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">when</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (data) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    ctx.body </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      response: data,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      endTime: Date.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">now</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(),</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 添加认证中间件</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">addMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">async</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">ctx</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">next</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  ctx.req.requestOptions.headers </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    ...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">ctx.req.requestOptions.headers,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    Authorization: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">`Bearer ${</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">getToken</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">()</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">}`</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  await</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> next</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><p>中间件上下文 (ctx) 包含以下属性：</p><ul><li><code>req</code>: 请求相关信息 <ul><li><code>requestOptions</code>: RestFetch 请求选项</li><li><code>requestInit</code>: 原生 fetch 请求配置</li></ul></li><li><code>res</code>: 响应相关信息 <ul><li><code>response</code>: 响应数据</li><li><code>when()</code>: 获取响应 Promise</li></ul></li><li><code>body</code>: 最终的响应数据</li><li><code>state</code>: 中间件之间共享的状态对象</li></ul><h3 id="响应处理" tabindex="-1">响应处理 <a class="header-anchor" href="#响应处理" aria-label="Permalink to &quot;响应处理&quot;">​</a></h3><p>可以自定义响应数据的处理方式：</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> client</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  baseURL: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;https://api.example.com&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  // 自定义响应处理</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  responseThen</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">blob</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h3 id="请求队列" tabindex="-1">请求队列 <a class="header-anchor" href="#请求队列" aria-label="Permalink to &quot;请求队列&quot;">​</a></h3><p>支持三种队列模式：</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 1. abort 模式：中断之前的请求</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/search&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  queue: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    id: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;search&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    mode: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;abort&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 2. wait 模式：等待之前的请求完成</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/search&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  queue: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    id: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;search&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    mode: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;wait&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 3. parallel 模式：并行执行 （默认）</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/search&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  queue: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    id: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;search&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    mode: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;parallel&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h3 id="请求缓存" tabindex="-1">请求缓存 <a class="header-anchor" href="#请求缓存" aria-label="Permalink to &quot;请求缓存&quot;">​</a></h3><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 使用缓存， 如果缓存 id 命中，则从 clone 流中直接读取</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> data</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/users/1&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  cache: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    id: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;user-1&#39;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 强制更新缓存</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> newData</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/users/1&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  cache: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    id: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;user-1&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    forceUpdate: </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">true</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h3 id="文件下载" tabindex="-1">文件下载 <a class="header-anchor" href="#文件下载" aria-label="Permalink to &quot;文件下载&quot;">​</a></h3><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">download</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/files/download&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  fileName: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;example.pdf&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 可选，自定义文件名</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  overwriteName: </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">true</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> // 可选，是否覆盖响应头中的文件名</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h3 id="流式响应" tabindex="-1">流式响应 <a class="header-anchor" href="#流式响应" aria-label="Permalink to &quot;流式响应&quot;">​</a></h3><p>用于处理服务器发送事件（SSE）等流式数据：</p><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> client.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">reader</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  url: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;/stream&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  onmessage</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">event</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    console.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">log</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;Received:&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, event.data)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">})</span></span></code></pre></div><h2 id="api-参考" tabindex="-1">API 参考 <a class="header-anchor" href="#api-参考" aria-label="Permalink to &quot;API 参考&quot;">​</a></h2><h3 id="构造函数选项" tabindex="-1">构造函数选项 <a class="header-anchor" href="#构造函数选项" aria-label="Permalink to &quot;构造函数选项&quot;">​</a></h3><table><thead><tr><th>参数</th><th>类型</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>baseURL</td><td>string</td><td>基础 URL</td><td>-</td></tr><tr><td>timeout</td><td>number</td><td>超时时间(ms)</td><td>-</td></tr><tr><td>presetRequestInit</td><td>(config: RequestInit) =&gt; RequestInit</td><td>前置请求配置 (setRequestInit之前)</td><td>-</td></tr><tr><td>setRequestInit</td><td>(config: RequestInit) =&gt; RequestInit</td><td>请求配置（可被请求选项覆盖）</td><td>-</td></tr><tr><td>responseThen</td><td>(res: Response) =&gt; any</td><td>响应拦截器</td><td>res =&gt; res.json()</td></tr><tr><td>requestThen</td><td>(data: any) =&gt; any</td><td>响应拦截器（responseThen之后）</td><td>data =&gt; data</td></tr><tr><td>ontimeout</td><td>(config: RequestInit) =&gt; void</td><td>超时回调</td><td>-</td></tr></tbody></table><h3 id="请求选项" tabindex="-1">请求选项 <a class="header-anchor" href="#请求选项" aria-label="Permalink to &quot;请求选项&quot;">​</a></h3><table><thead><tr><th>参数</th><th>类型</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>url</td><td>string</td><td>请求路径</td><td>-</td></tr><tr><td>baseURL</td><td>string</td><td>覆盖构造函数中的基础 URL</td><td>-</td></tr><tr><td>method</td><td>‘GET’ | ‘POST’ | ‘PUT’ | ‘DELETE’</td><td>请求方法</td><td>-</td></tr><tr><td>headers</td><td>object</td><td>请求头</td><td>-</td></tr><tr><td>params</td><td>object</td><td>URL 参数</td><td>-</td></tr><tr><td>data</td><td>object</td><td>请求体数据</td><td>-</td></tr><tr><td>contentType</td><td>‘application/json’ | ‘application/x-www-form-urlencoded’ | ‘multipart/form-data’</td><td>内容类型</td><td>‘application/json’</td></tr><tr><td>setRequestInit</td><td>(config: RequestInit) =&gt; RequestInit</td><td>请求配置，覆盖构造函数配置</td><td>-</td></tr><tr><td>responseThen</td><td>-</td><td>响应拦截器，覆盖构造函数配置</td><td>-</td></tr><tr><td>timeout</td><td>number</td><td>请求超时时间，覆盖构造函数配置</td><td>-</td></tr><tr><td>ontimeout</td><td>(config: RequestInit) =&gt; void</td><td>超时回调，覆盖构造函数配置</td><td>-</td></tr><tr><td>abortController</td><td>AbortController</td><td>自定义中断控制器</td><td>new AbortController()</td></tr><tr><td>cache</td><td>{ id: string, forceUpdate?: boolean }</td><td>缓存配置</td><td>-</td></tr><tr><td>queue</td><td>{ id: string, mode?: ‘abort’ | ‘wait’ | ‘parallel’, leave?: boolean }</td><td>队列配置</td><td>-</td></tr></tbody></table><h3 id="中间件方法" tabindex="-1">中间件方法 <a class="header-anchor" href="#中间件方法" aria-label="Permalink to &quot;中间件方法&quot;">​</a></h3><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>addMiddleware(fn: RestFetchMiddleware)</td><td>添加中间件</td></tr><tr><td>removeMiddleware(fn: RestFetchMiddleware)</td><td>移除中间件</td></tr></tbody></table><h3 id="中间件接口" tabindex="-1">中间件接口 <a class="header-anchor" href="#中间件接口" aria-label="Permalink to &quot;中间件接口&quot;">​</a></h3><div class="language-typescript"><button class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">S</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Record</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;&gt; {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">ctx</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddlewareContext</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">S</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;, </span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">next</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;)</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddlewareContext</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">S</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Record</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;&gt; {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  req</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestOptions</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> // 请求选项</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> // 原生请求参数</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    response</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> // 响应数据</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">    when</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt; </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 获取响应Promise</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  state</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> S</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> // 中间件共享状态</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  body</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> // 最终响应数据</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span></code></pre></div><h2 id="基础示例" tabindex="-1">基础示例 <a class="header-anchor" href="#基础示例" aria-label="Permalink to &quot;基础示例&quot;">​</a></h2><!----><h2 id="流式响应示例" tabindex="-1">流式响应示例 <a class="header-anchor" href="#流式响应示例" aria-label="Permalink to &quot;流式响应示例&quot;">​</a></h2><p>开启 <code>node server.cjs</code> 后预览。</p><!----><h2 id="源码" tabindex="-1">源码 <a class="header-anchor" href="#源码" aria-label="Permalink to &quot;源码&quot;">​</a></h2><details class="details custom-block"><summary>fetch/RestFetch</summary><div class="language-ts"><button class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-dark github-light" style="--shiki-dark:#e1e4e8;--shiki-light:#24292e;--shiki-dark-bg:#24292e;--shiki-light-bg:#fff;" tabindex="0"><code v-pre><span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> type</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { AnyFunc, NormalObject, ReturnVoid } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;@vunk/shared&#39;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> type</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { EventSourceParseCallback } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;eventsource-parser&#39;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { noop } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;@vunk-shared/function&#39;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { Deferred } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;@vunk-shared/promise&#39;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { createParser } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;eventsource-parser&#39;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { stringify } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">from</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;qs&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> class</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  baseURL</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;baseURL&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  setRequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;setRequestInit&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  presetRequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;presetRequestInit&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  responseThen</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;responseThen&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  requestThen</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;requestThen&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  timeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;timeout&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  ontimeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;ontimeout&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  protected</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;"> caches</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Record</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;&gt;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  protected</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;"> queues</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Record</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    promise</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    abortController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> AbortController</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }[]&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 中间件队列</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  protected</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;"> middlewareQueue</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  async</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> runMiddlewares</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">ctx</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">index</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 0</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (index </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">===</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">length</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      return</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> middleware</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue[index]</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    await</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> middleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(ctx, () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">runMiddlewares</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(ctx, index </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">))</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  constructor</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.baseURL </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.baseURL</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.setRequestInit </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.setRequestInit</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.presetRequestInit </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.presetRequestInit</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.responseThen </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.responseThen </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">json</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">())</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.requestThen </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.requestThen </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.timeout </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.timeout</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.ontimeout </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.ontimeout</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.caches </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {}</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {}</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  use</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">plugin</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchPlugin</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">...</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">args</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) { </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">return</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> plugin</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">args) }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  ) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> readyPromise</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.cache?.id) { </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 如果提供缓存id 则从缓存获取promise</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.caches[options.cache.id] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.cache.forceUpdate) { </span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">// 如果没有缓存先赋值, 或者需要强制更新缓存</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">        this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.caches[options.cache.id] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">initFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(options, requestInit)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      readyPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.caches[options.cache.id]</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // https://github.com/whatwg/fetch/issues/196</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // res.json() 会消耗流数据 需要clone以便重用</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">clone</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">())</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    else</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      readyPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">initFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(options, requestInit)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> responseThen</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.responseThen </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.responseThen</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> readyPromise.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(responseThen)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  async</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> request</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    state</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> NormalObject</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  ) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> responseDef</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Deferred</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> when</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> responseDef.promise</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> middlewareCtx</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      req: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        requestOptions: options,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        requestInit,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      },</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      res: {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        when,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        response: </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">undefined</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      },</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      state: state </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {},</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      body: </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">undefined</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    // 定义 next 函数</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> next</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> async</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">index</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 0</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (index </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">&gt;=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">length</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        return</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // 获取下一个中间件</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> middleware</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue[index]</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      await</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> middleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(middlewareCtx, () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> next</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(index </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">))</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> middlewarePromise</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> next</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      middlewareCtx.req.requestOptions,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      middlewareCtx.req.requestInit,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    )</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">((</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        middlewareCtx.res.response </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        middlewareCtx.body </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        responseDef.resolve,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        responseDef.reject,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> responseDef</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .promise</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(() </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> middlewarePromise)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(() </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> middlewareCtx.body)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.requestThen)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  async</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> download</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    downloadOpts</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">      url</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">      fileName</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">      overwriteName</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> boolean</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    },</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Partial</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  ) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    return</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;POST&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        url: downloadOpts.url,</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">        responseThen</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res,</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        ...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">options,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      }, requestInit)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">((</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> headers</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res.headers</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">        // 获取文件名</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> fileName </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> downloadOpts.fileName </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> `${</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Date</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">()</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">}`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">downloadOpts.overwriteName </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> !</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">downloadOpts.fileName) {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">          // 如果不是确认覆盖文件名，或者没有提供文件名</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">          // 尝试从响应头获取文件名</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> disposition</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> headers.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">get</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;content-disposition&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (disposition) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> reg</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> /</span><span style="--shiki-dark:#DBEDFF;--shiki-light:#032F62;">filename</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">[*^]</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?</span><span style="--shiki-dark:#DBEDFF;--shiki-light:#032F62;">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?</span><span style="--shiki-dark:#DBEDFF;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?</span><span style="--shiki-dark:#DBEDFF;--shiki-light:#032F62;">(</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">[</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">^</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">&amp;;&quot;]</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">*</span><span style="--shiki-dark:#DBEDFF;--shiki-light:#032F62;">)&quot;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">/</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> fileNameEncode</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> reg.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">exec</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(disposition)?.[</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (fileNameEncode) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">              fileName </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> decodeURIComponent</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(fileNameEncode)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">            }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> ns</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> fileName.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">split</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">`&#39;`</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (ns.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">length</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> &gt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> 1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">              // [&#39;utf-8&#39;, &#39;en&#39;, &#39;filename&#39;]</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">              const</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> [</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">charset</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, , </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">...</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">names</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> ns</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">              if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> ([</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;utf-8&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">].</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">includes</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(charset.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">toLocaleLowerCase</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">())) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">                fileName </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> names.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">join</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">`&#39;`</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">              }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">            }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        return</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">all</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">([</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          res.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">blob</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(),</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          fileName,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        ])</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      .</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(([</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">blob</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">fileName</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">]) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> link</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> document.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">createElement</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;a&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        link.href </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> window.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">URL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">createObjectURL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(blob)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        link.download </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> fileName</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        link.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">click</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        window.</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">URL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">revokeObjectURL</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(link.href)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  async</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> reader</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    readerOpts</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">      url</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">      onmessage</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> EventSourceParseCallback</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">      abortController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> AbortController</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    },</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestOptions</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Partial</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  ) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> onmessage</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> readerOpts.onmessage </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> noop</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> reader</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> ReadableStreamDefaultReader</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Uint8Array</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt; </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> await</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      url: readerOpts.url,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      method: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;POST&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">      responseThen</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res.body?.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">getReader</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(),</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      abortController: readerOpts.abortController,</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      ...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">requestOptions,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }, requestInit)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> decoder</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> TextDecoder</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;utf-8&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> parser</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> createParser</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(onmessage)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">reader)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      return</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    while</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">true</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> { </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">done</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">value</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> } </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> await</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> reader.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">read</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (done)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        break</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      parser.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">feed</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(decoder.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">decode</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(value))</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">  private</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> async</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> initFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    init</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  )</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt; {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /* 超时处理 */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> abortController </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.abortController</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">abortController) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      abortController </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> AbortController</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> timeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.timeout </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.timeout</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /* 超时处理 end */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> headers</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Headers</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    // 初始化init参数</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> config</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      method: options.method,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      headers,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      signal: abortController?.signal,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> postContentType</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.contentType </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;application/json&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.method </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!==</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;GET&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      headers.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">set</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;Content-Type&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, postContentType)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      switch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (postContentType) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        case</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;application/json&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          config.body </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> JSON</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">stringify</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(options.data)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          break</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        case</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;application/x-www-form-urlencoded&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          config.body </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> stringify</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(options.data)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          break</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        case</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;multipart/form-data&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">        // 默认会生成带hash的 ContentType</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          headers.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">delete</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;Content-Type&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> formData </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> new</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> FormData</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.data) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.data </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">instanceof</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> FormData</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">              formData </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.data</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">            }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">            else</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">              const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> keys</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> Reflect.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">ownKeys</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(options.data) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">as</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">[]</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">              keys.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">forEach</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">((</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">key</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">                formData.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">append</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(key, options.data?.[key] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">as</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Blob</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">              })</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">            }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          config.body </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> formData</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          break</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    // 设置请求头</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.headers) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      Object.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">keys</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(options.headers).</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">forEach</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">((</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">key</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        headers.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">set</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(key, options.headers?.[key])</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    // 将params 参数拼接到url</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> params </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.params) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      params </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> `?${</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">stringify</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">(</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">options</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">params</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">)</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">}`</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> input</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.baseURL </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">||</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.baseURL) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.url </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">+</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> params</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    // 请求拦截</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> setRequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.setRequestInit </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.setRequestInit</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.presetRequestInit) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      config </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">presetRequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(config)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (setRequestInit) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      config </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> setRequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(config)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetchFn</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> p</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(input, {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        ...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">config,</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        ...</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">init,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      }).</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">((</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">res.ok)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">          return</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">reject</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(res)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      /* 超时处理2 */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">timeout)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> p</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> ontimeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.ontimeout </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.ontimeout</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> timeoutId</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> window.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">setTimeout</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(() </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        abortController?.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">abort</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">        ontimeout</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">?.(config)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      }, timeout)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      p.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">finally</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(() </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        window.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">clearTimeout</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(timeoutId)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      /* 超时处理2 end */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> p</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    let</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> fetchPromise</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt; </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">|</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> undefined</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /* 设置队列 */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">options.queue?.id)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      ||</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> options.queue.leave</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    ) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      fetchPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetchFn</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> fetchPromise</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id]) {</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">      this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> []</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.queue.mode </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">===</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;parallel&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      fetchPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetchFn</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // 并行模式, 直接push</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">      this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id].</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">push</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        promise: fetchPromise,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        abortController,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    else</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (options.queue.mode </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">===</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;wait&#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // 等待其他请求完成</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> promises</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id].</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">map</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(({ </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> }) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> promise)</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // 所有请求完成，无论成功失败</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">      const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> others</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">allSettled</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(promises)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      fetchPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> others.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">then</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(() </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">        return</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetchFn</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // 清空之前队列，只保留当前请求</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">      this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> [</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          promise: fetchPromise,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">          abortController,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        },</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      ]</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    else</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">      // 取消其他请求</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">      this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id].</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">forEach</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(({ </span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">abortController</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> }) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        abortController?.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">abort</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      })</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      fetchPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetchFn</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">      this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.queues[options.queue.id] </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> [{</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        promise: fetchPromise,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">        abortController,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">      }]</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /* 设置队列 end */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    return</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> fetchPromise </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">??</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> fetchFn</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  addMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">fn</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">    this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">push</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(fn)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  removeMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">fn</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    const</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> index</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">indexOf</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(fn)</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">    if</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (index </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">!==</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> -</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">      this</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">.middlewareQueue.</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">splice</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">(index, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">1</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> type</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchPlugin</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">restFetch</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetch</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">...</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">args</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">type</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> ContentType</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;application/json&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;application/x-www-form-urlencoded&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;multipart/form-data&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddlewareContext</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">S</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> NormalObject</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt; {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  req</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * request 参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestOptions</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 原生请求参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * this.response 返回值</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    response</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 返回 respose Promise</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">    when</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 中间件提供的参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  state</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> S</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 接口返回值</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  body</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddleware</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">S</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> NormalObject</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt; {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">ctx</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchMiddlewareContext</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">S</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;, </span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">next</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> () </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;)</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> * RestFetch 构造函数参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchConstructorOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  baseURL</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求拦截 在  setRequestInit 和 requestInterceptorQueue 之前</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  presetRequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">config</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求拦截 设置 RequestInit</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  setRequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">config</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 响应拦截</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">@default</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> =&gt; res.json()</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  responseThen</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 响应拦截, 发生在 responseThen 之后</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">@default</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> res</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> =&gt; res</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  requestThen</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> AnyFunc</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 默认超时时间</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 单位 ms</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  timeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> number</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 超时回调</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  ontimeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">config</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> ReturnVoid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> * restFetch.request 参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求地址</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * baseURL + url</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  url</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 覆盖 RestFetchConstructorOptions 的 baseURL</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  baseURL</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  method</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;POST&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;GET&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;PUT&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;DELETE&#39;</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求体</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  data</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Record</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求地址拼接参数</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  params</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Record</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">string</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">, </span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求头</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">@default</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {}</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  headers</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> NormalObject</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求头</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">@default</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">application/json</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  contentType</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> ContentType</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 请求拦截 设置 RequestInit</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 会覆盖 RestFetchConstructorOptions 的 setRequestInit</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   *</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  setRequestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">config</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 响应拦截</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 会覆盖 RestFetchConstructorOptions 的 responseThen</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  responseThen</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">res</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> any</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 自定义 AbortController</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * timeout 时间到会自动 abort</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">@default</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> new</span><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> AbortController()</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  abortController</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> AbortController</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 超时时间</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 单位 ms</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 会覆盖 RestFetchConstructorOptions 的 timeout</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  timeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> number</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 超时回调</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 会覆盖 RestFetchConstructorOptions 的 ontimeout</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">  ontimeout</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">config</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">) </span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">=&gt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> ReturnVoid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 设置缓存</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  cache</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 唯一标识</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    id</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 是否强制更新</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    forceUpdate</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> boolean</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">  /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   * 队列</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">   */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">  queue</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 唯一标识</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    id</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> string</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 选择模式，</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * abort. 有相同id的请求，打断之前的请后执行</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * wait. 有相同id的请求，等待之前的请求完成后再执行</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * parallel. 仅加入队列，与队列中其他请求并行执行</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    mode</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;abort&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;wait&#39;</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> |</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> &#39;parallel&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     * 是否离开队列</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    leave</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> boolean</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  }</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> * restFetch.response</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchResponse</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  )</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Response</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> * restFetch.request</span></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> interface</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequest</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  (</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    options</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchRequestOptions</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    state</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> NormalObject</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#FFAB70;--shiki-light:#E36209;">    requestInit</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">?:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RequestInit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">  )</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">:</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> Promise</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&lt;</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">any</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">&gt;</span></span>
<span class="line"><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> type</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> RestFetchReaderOnmessage</span><span style="--shiki-dark:#F97583;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;"> EventSourceParseCallback</span></span></code></pre></div><p>fetch/RestFetch</p></details></div><!--]--></div><div class="doc-toc-container"><div class="VPDocAsideOutline has-outline" role="navigation" data-v-a23cb9b6><div class="content" data-v-a23cb9b6><nav aria-labelledby="doc-outline-aria-label" data-v-a23cb9b6><span id="doc-outline-aria-label" class="visually-hidden" data-v-a23cb9b6> Table of Contents for current page </span><!--[--><div class="vp-doc-outline-x" data-v-a23cb9b6><ul class="VPDocOutlineItem toc-items root" data-v-a23cb9b6 data-v-d3f5820b><!--[--><!--]--></ul><!----></div><!--]--></nav></div></div></div></div></main><!--]--></div></div><!--[--><div class="el-scrollbar__bar is-horizontal" style="display:none;"><div class="el-scrollbar__thumb" style="width:;transform:translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical" style="display:none;"><div class="el-scrollbar__thumb" style="height:;transform:translateY(0%);"></div></div><!--]--></div><!--]--></div></div></div><!--]--></div></div></div>
        <div id="teleported"></div>
        <script id="vike_pageContext" type="application/json">{"fromHtmlRenderer":{},"crowdin":{"pages/component.json":{"lang":"zh-CN","path":"pages/component.json","basename":"component.json","source":{}},"pages/guide.json":{"lang":"zh-CN","path":"pages/guide.json","basename":"guide.json","source":{"start":{"text":"Start 开始","children":[{"link":"introduction","text":"Introduction 介绍"}]}}},"pages/nav.json":{"lang":"zh-CN","path":"pages/nav.json","basename":"nav.json","source":[{"label":"指南","value":"guide","path":"guide","redirect":"guide/introduction"},{"label":"组件","value":"component","path":"component","redirect":"component/array/bubbleSort"}]}},"_urlRewrite":null,"pageId":"/pages/zh-CN/component/fetch/RestFetch","routeParams":{}}</script>
        <script src="/vunk-shared/assets/entries/entry-client-routing.BZtDTeMj.js" type="module" async></script>
        <link rel="modulepreload" href="/vunk-shared/assets/entries/pages_zh-CN_component_fetch_RestFetch.B4Llk5xc.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/vunk-shared/assets/chunks/chunk-CqyrWHim.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/vunk-shared/assets/chunks/chunk-D-Re98Cy.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/vunk-shared/assets/chunks/chunk-BIhtd8Mu.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/vunk-shared/assets/chunks/chunk-DYXjVhsj.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/vunk-shared/assets/chunks/chunk-B9fUFN9S.js" as="script" type="text/javascript">
      </body>
    </html>